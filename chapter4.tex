%Status: unchecked
%Todo: bevezet?, specifikáció szövegesítése, hardware bevezet?, weblap (root)


%----------------------------------------------------------------------------
\chapter{Programozható aljzat árammérõvel}
%----------------------------------------------------------------------------

%----------------------------------------------------------------------------
\section{Specifikáció}
%----------------------------------------------------------------------------


\begin{itemize}  
	\item 1 foglalat
	\item Feszültségmérés, és árammérés
\end{itemize}


%----------------------------------------------------------------------------
\section{Hardver}
%----------------------------------------------------------------------------

\begin{table}[ht]
	\footnotesize
	\centering
	\caption{A környezeti szenzor alkatrész listája}
	\begin{tabular}{|c|c|c|c|c|c|}
		\hline
		& \textbf{Db.} 	& \textbf{Leírás} 	& \textbf{Felh.} 	& \textbf{Gyártó} 	& \textbf{Azonosító} \\ 
		\hline
		1 & 1 & WiFi-s mikrokontroller & U1 & Espressif & ESP8285 \\
		\hline
		2 & 1 & Rezonátor kristály & U2 & Epson & FA-128 26Mhz \\
		\hline		
		3 & 1 & Nyomógomb & SW1 & CandK Components & D6C90 F2 LFS \\
		\hline
		4 & 3 & LED (0603) & D1..3 & Panasonic & LNJxxx \\
		\hline
		5 & 3 & Olvadóbiztosíték & F1,F2 & Shurter & 3403.0173.11 \\
		\hline
		6 & 1 & Relé & SW1 & TE Connectivity & RTE24005 \\
		\hline
		7 & 1 & Tranzisztor & Q1 & ON Semiconductor & MMBT2222ALT1G \\
		\hline
		8 & 1 & Egyenirányító & D4 & Rectron & FM4007W-W \\
		\hline
		9 & 1 & Tépegység 230AC->5V & x & Vigortronix & VTX-214-003-105 \\
		\hline
		10 & 1 & Buck 5V->3.3V & U4 & TI & LM3670MF-3.3 \\
		\hline
		11 & 1 & Header & P1 & Omron & XG8V-0831 \\ 
		\hline
		12 & 1 & Teljesítmény mérõ IC & U3 & ST & STPM10BTR \\
		\hline
		13 & 1 & Rezonátor kristály & Y1 & Abracon & ABLS-4.194304MHZ \\
		\hline
		14 & 1 & Árammérõ sönt & R25 & Wishay & WSLP5931 \\
		\hline
		15 & 1 & AC Csatlakozó & P1 & Qualtek & 703W-00/54 \\
		\hline
		16 & 1 & AC Foglalat & P2 & x  & x \\
		\hline
		17 & 26 & Ellenállás (0603) & R1..26 & Viking Tech Corp. & - \\
		\hline
		18 & 19 & Kondenzátor (0603) & C1..19 & Yageo, Samsung & - \\
		\hline

	\end{tabular} 
\end{table}

%----------------------------------------------------------------------------
\subsection{Tápellátás}
%----------------------------------------------------------------------------

Ez az egység a m\H{u}ködéséhez szükséges energiát 230V-os hálózatból veszi fel. A teljesítménymér? chip és a WiFi-s mikrokontroller 3.3V is tápellátást kap, mig a relé meghajtásához 5V-ra van szükség.

%----------------------------------------------------------------------------
\subsubsection{Vigortronix VTX-214-003-105 \cite{vtx-214-003-105-ds}}
%----------------------------------------------------------------------------

%----------------------------------------------------------------------------
\subsubsection{Texas Instruments LM3670MF-3.3 \cite{lm3670mf-ds}}
%----------------------------------------------------------------------------

%----------------------------------------------------------------------------
\subsection{Teljesítménymérés}
%----------------------------------------------------------------------------

Ide pofátlanul sok mehet.

%----------------------------------------------------------------------------
\section{Szofver}
%----------------------------------------------------------------------------

%----------------------------------------------------------------------------
\section{Paraméteres interface}
%----------------------------------------------------------------------------
\label{sec:parameters}

A hálózatba kapcsolt eszközök programozhatóságát nagy mértékben megkönnyíti, ha azok kívülr?l nézve bizonyos szempontból egységesek. Az absztrakció lehet egy, az eszközhöz hozzárendelt paraméterek halmaza, amelyek olvashatóak és esetenként írhatóak is. Például a pillanatnyi teljesítményt a power változó tartalmazza, ami csupán olvasható. Az hogy egy paraméter kívülrõl változónak t?nik, nem jelenti feltétlenül azt, hogy az az eszközön belül mindíg elérhet?, lehet az a lekérdezés által megindított folyamat (legtöbb esetben mérés) eredménye is. Azon funkciók amik beavatkoznak a környezetbe, írható változókként reprezentálhatóak.
A relé állása a relay változóba írt 0 vagy 1 értékkel állítható. Innentõl kezdve a teljes rendszer a szolgáltatott paraméterek, mint változók manipulálásával programozhatóak.
Ez a protokol, bár meglehetõsen rugalmas, az összes perifériát szolga (slave) szerepbe kényszeríti, mivel minden tranzakciót (írást/olvasást) a központi egység kezdeményez. Ha valamelyik periférián lenyomott gombhoz akarok akciót rendelni, akkor ezt csak úgy tehetem meg ha a hozzárendelt változót a másik eszközrõl pollolom, ami valamekkora idõveszteséggel jár.

A kiolvasás az WiFi-s eszköz által biztosított JSON (JavaScript Object Notation) interface-en keresztül történik. A JSON egy ember által is olvasható szöveges leírószabvány, ami az XML mellet a web legelterjedtebb formátuma. Az én implementációmban csak az összes változó egyidej\H{u} lekérdezésére van lehetõség, de a visszafele kompatibilitást megtartva hozzá lehetne adni a protokolhoz a változókra történõ sz\H{u}rés lehetõségét. A szenzor által biztosított JSON oldal:
\begin{lstlisting}
{
	"relay": "0",
	"led": "1",
	"power": "0.00",
	"voltage": "0.00",
	"current": "0.00",
	"powerfactor": "0.00"
} 
\end{lstlisting}

A paraméterek írásához a HTTP (Hypertext Transfer Protocol) GET vagy POST metódusa használható a /control oldalnak átadva. A GET paraméterek címsorba kódolhatóak: 
\begin{lstlisting}
http://192.168.0.20/control?relay=1&led=0
\end{lstlisting}
A változtatások érvényre jutását az eszköz a Done üzenettel jelzi.


\begin{table}[ht]
	\footnotesize
	\centering
	\caption{A Programozható aljzat paraméterei}
	\begin{tabular}{|l|l|l|l|}
		\hline
		\textbf{Név} & \textbf{Hozzáférés} 	& \textbf{Típus} & \textbf{Leírás}  \\ 
		\hline
		relay & írható/olvasható & boolean & a relé állapota \\
 		\hline
 		led & írható/olvasható & boolean & led állapota \\
 		\hline
 		power & olvasható & float & teljesítmény (W) \\
 		\hline
 		voltage & olvasható & float & feszültség (V) \\
 		\hline
 		current & olvasható & float & áram (A)\\
 		\hline
 		powerfactor & olvasható & float & teljesítmény tényezõ \\
 		\hline		
	\end{tabular} 
\end{table}




%----------------------------------------------------------------------------
\section{Prototípus}
%----------------------------------------------------------------------------

-enable fix

-5V to 3.3V

-relay

-random kikapcsolás

-kommunikáció


